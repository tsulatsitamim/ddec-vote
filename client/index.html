<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Daihatsu Dress Up Challenge</title>

    <script
      src="https://cdn.jsdelivr.net/npm/vue@2.6.14/dist/vue.js"
      type="text/javascript"
    ></script>
    <script
      src="https://unpkg.com/daihatsu-ui@3.1.3/dist/daihatsu.min.js"
      type="text/javascript"
    ></script>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
    />
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap"
    />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/tw-elements/dist/css/index.min.css"
    />

    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;500&display=swap"
      rel="stylesheet"
    />

    <link
      href="https://daihatsu.co.id/ddec-vote/assets/css/main.css?v=2"
      rel="stylesheet"
    />
    <!-- <link href="/assets/css/main.css" rel="stylesheet" /> -->
    <script src="//unpkg.com/alpinejs" defer></script>

    <!-- Google Tag Manager -->
    <script>
      (function (w, d, s, l, i) {
        w[l] = w[l] || [];
        w[l].push({ "gtm.start": new Date().getTime(), event: "gtm.js" });
        var f = d.getElementsByTagName(s)[0],
          j = d.createElement(s),
          dl = l != "dataLayer" ? "&l=" + l : "";
        j.async = true;
        j.src = "https://www.googletagmanager.com/gtm.js?id=" + i + dl;
        f.parentNode.insertBefore(j, f);
      })(window, document, "script", "dataLayer", "GTM-MLSQLK");
    </script>
    <!-- End Google Tag Manager -->
  </head>
  <body class="text-dark">
    <daihatsu-navbar></daihatsu-navbar>
    <section id="banner" class="pt-[59px] md:pt-0">
      <picture>
        <source
          media="(min-width: 576px)"
          srcset="
            https://daihatsu.co.id/ddec-vote/assets/images/banner-desktop.jpg?v=2
          "
        />
        <img
          class="w-full h-auto"
          src="https://daihatsu.co.id/ddec-vote/assets/images/banner-mobile.jpg?v=2"
          alt="banner"
        />
      </picture>
    </section>
    <section
      style="
        background: url('https://daihatsu.co.id/ddec-vote/assets/images/bg.jpg');
      "
      class="px-6 py-6 pb-10 md:py-16 text-white"
    >
      <div
        class="uppercase text-center font-bold text-2xl sm:text-3xl md:text-5xl mb-6 md:mb-16"
      >
        Last Match Result
      </div>
      <div
        class="flex flex-wrap md:flex-nowrap justify-around md:justify-center"
      >
        <div
          class="w-1/3 max-w-md py-6 md:py-10 border border-white relative order-2 md:order-1"
        >
          <img
            class="object-contain aspect-video"
            src="https://daihatsu.co.id/ddec-vote/assets/images/Pemenang Indonesia@2x.png"
            alt=""
          />
          <button
            data-bs-toggle="modal"
            data-bs-target="#formVote"
            onclick="openModal('indonesia')"
            class="md:min-w-[150px] inline-block px-6 py-2.5 bg-red-700 text-white font-medium text-xs lg:text-base leading-tight uppercase rounded-full shadow-md hover:bg-red-500 hover:shadow-lg focus:bg-red-500 focus:shadow-lg focus:outline-none focus:ring-0 active:bg-red-500 active:shadow-lg transition duration-150 ease-in-out absolute bottom-0 right-1/2 translate-x-1/2 translate-y-1/2"
          >
            Vote
          </button>
        </div>
        <div
          class="flex flex-col items-center justify-center mx-4 sm:mx-6 md:mx-10 order-1 md:order-2 w-full md:w-auto mb-4 md:mb-0"
        >
          <div
            id="time-counter"
            class="mb-2 text-xs sm:text-base md:text-lg"
          ></div>
          <div
            class="font-bold text-2xl sm:text-5xl md:text-7xl whitespace-nowrap"
          >
            <span id="indonesia-score">0</span> -
            <span id="malaysia-score">0</span>
          </div>
        </div>
        <div
          class="w-1/3 max-w-md py-6 md:py-10 border border-white relative order-3 md:order-3"
        >
          <img
            class="object-contain aspect-video"
            src="https://daihatsu.co.id/ddec-vote/assets/images/Pemenang Malaysia@2x.png"
            alt=""
          />
          <button
            data-bs-toggle="modal"
            data-bs-target="#formVote"
            onclick="openModal('malaysia')"
            class="md:min-w-[150px] inline-block px-6 py-2.5 bg-red-700 text-white font-medium text-xs lg:text-base leading-tight uppercase rounded-full shadow-md hover:bg-red-500 hover:shadow-lg focus:bg-red-500 focus:shadow-lg focus:outline-none focus:ring-0 active:bg-red-500 active:shadow-lg transition duration-150 ease-in-out absolute bottom-0 right-1/2 translate-x-1/2 translate-y-1/2"
          >
            Vote
          </button>
        </div>
      </div>
    </section>
    <daihatsu-footer></daihatsu-footer>
    <div
      class="modal fade fixed top-0 left-0 hidden w-full h-full outline-none overflow-x-hidden overflow-y-auto"
      id="formVote"
      data-bs-backdrop="static"
    >
      <div class="modal-dialog relative w-auto pointer-events-none">
        <div
          class="modal-content border-none shadow-lg relative flex flex-col w-full pointer-events-auto bg-white bg-clip-padding rounded-md outline-none text-current"
        >
          <div
            class="modal-header flex flex-shrink-0 items-center justify-between p-4 border-b border-gray-200 rounded-t-md"
          >
            <h5
              class="text-xl font-medium leading-normal text-gray-800 capitalize"
              id="modalLabel"
            >
              Form Vote
            </h5>
            <button
              onclick="resetError()"
              type="button"
              class="box-content w-4 h-4 p-1 text-black border-none rounded-none opacity-50 focus:shadow-none focus:outline-none focus:opacity-100 hover:text-black hover:opacity-75 hover:no-underline"
              data-bs-dismiss="modal"
              aria-label="Close"
            >
              <svg
                xmlns="http://www.w3.org/2000/svg"
                fill="none"
                viewBox="0 0 24 24"
                stroke-width="1.5"
                stroke="currentColor"
                class="w-6 h-6"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  d="M6 18L18 6M6 6l12 12"
                />
              </svg>
            </button>
          </div>
          <div class="modal-body relative p-4"></div>
          <div
            class="modal-footer flex flex-shrink-0 flex-wrap items-center justify-end p-4 border-t border-gray-200 rounded-b-md"
          >
            <button
              id="submitVote"
              type="button"
              onclick="vote('Indonesia')"
              class="inline-block px-6 py-2.5 bg-blue-600 text-white font-medium text-xs leading-tight uppercase rounded shadow-md hover:bg-blue-700 hover:shadow-lg focus:bg-blue-700 focus:shadow-lg focus:outline-none focus:ring-0 active:bg-blue-800 active:shadow-lg transition duration-150 ease-in-out ml-1"
            >
              Submit
            </button>
          </div>
        </div>
      </div>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/tw-elements/dist/js/index.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/dayjs@1/dayjs.min.js"></script>
    <script>
      const resetError = () => {
        document.getElementById("error-container").innerHTML = "";
        document.getElementById("error-name").innerHTML = "";
        document.getElementById("error-email").innerHTML = "";
        document.getElementById("error-phone").innerHTML = "";
      };

      const vote = async () => {
        resetError();
        const payload = {
          name: document.getElementById("fName").value,
          email: document.getElementById("fEmail").value,
          phone: document.getElementById("fPhone").value,
          candidate: document.getElementById("fCandidate").value,
        };

        const res = await fetch(
          // "https://daihatsu.co.id/daihatsu-setia-club-api/participants",
          "/ddec-vote-api/votes",
          {
            method: "POST",
            headers: {
              Accept: "application/json",
              "Content-Type": "application/json",
            },
            body: JSON.stringify(payload),
          }
        );

        const data = await res.json();

        if (!res.ok) {
          if (data?.errors) {
            const errors = data?.errors.reduce(function (rv, x) {
              (rv[x["param"]] = rv[x["param"]] || []).push(x);
              return rv;
            }, {});

            Object.keys(errors).forEach((key) => {
              document.getElementById(`error-${key}`).innerHTML =
                errors[key][0].msg;
            });
          } else {
            document.getElementById("error-container").innerHTML =
              data?.message || data?.errors;
            ("Mohon maaf terjadi gangguan server!");
          }
        } else {
          const modalBody = document.getElementsByClassName("modal-body")[0];
          const modalFooter =
            document.getElementsByClassName("modal-footer")[0];
          modalBody.innerHTML = `
            <div class="flex flex-col justify-center items-center">
              <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-10 h-10 text-green-500 mb-6">
                <path stroke-linecap="round" stroke-linejoin="round" d="M9 12.75L11.25 15 15 9.75M21 12c0 1.268-.63 2.39-1.593 3.068a3.745 3.745 0 01-1.043 3.296 3.745 3.745 0 01-3.296 1.043A3.745 3.745 0 0112 21c-1.268 0-2.39-.63-3.068-1.593a3.746 3.746 0 01-3.296-1.043 3.745 3.745 0 01-1.043-3.296A3.745 3.745 0 013 12c0-1.268.63-2.39 1.593-3.068a3.745 3.745 0 011.043-3.296 3.746 3.746 0 013.296-1.043A3.746 3.746 0 0112 3c1.268 0 2.39.63 3.068 1.593a3.746 3.746 0 013.296 1.043 3.746 3.746 0 011.043 3.296A3.745 3.745 0 0121 12z" />
              </svg>
              <p class="text-lg font-bold">Selamat Vote Anda Berhasil!</p>
            </div>
          `;
          modalFooter.classList.add("hidden");
        }
      };

      const getVotes = async () => {
        try {
          const res = await fetch(
            "/ddec-vote-api/result"
            // "http://localhost:3000/result"
          );
          const data = await res.json();
          Object.keys(data).forEach((key) => {
            document.getElementById(`${key}-score`).innerHTML = data[key];
          });
          console.log(data);
        } catch (error) {}
      };

      getVotes();
      setInterval(async () => await getVotes(), 600000);

      const openModal = async (candidate) => {
        const modalBody = document.getElementsByClassName("modal-body")[0];
        modalBody.innerHTML = `<div class="mb-5">
              <label for="fName" class="mb-3 block text-base text-dark">
                Nama
              </label>
              <input
                type="text"
                name="fName"
                id="fName"
                placeholder="Masukan Nama Anda"
                class="w-full rounded-md bg-[#f7f7f7] py-3 px-6 text-base text-[#6B7280] outline-none focus:border-[#6A64F1] focus:shadow-md"
              />
              <span id="error-name" class="text-red-500 text-xs"></span>
            </div>
            <div class="mb-5">
              <label for="fEmail" class="mb-3 block text-base text-dark">
                Email
              </label>
              <input
                type="text"
                name="fEmail"
                id="fEmail"
                placeholder="Masukan Email Anda"
                class="w-full rounded-md bg-[#f7f7f7] py-3 px-6 text-base text-[#6B7280] outline-none focus:border-[#6A64F1] focus:shadow-md"
              />
              <span id="error-email" class="text-red-500 text-xs"></span>
            </div>
            <div class="mb-5">
              <label for="fPhone" class="mb-3 block text-base text-dark">
                Nomor HP
              </label>
              <input
                type="text"
                name="fPhone"
                id="fPhone"
                placeholder="Masukan Nomor HP Anda"
                class="w-full rounded-md bg-[#f7f7f7] py-3 px-6 text-base text-[#6B7280] outline-none focus:border-[#6A64F1] focus:shadow-md"
              />
              <span id="error-phone" class="text-red-500 text-xs"></span>
            </div>
            <div class="mb-5">
              <p id="error-container" class="text-red-500 text-xs"></p>
            </div>
            <div class="mb-5 hidden">
              <input
                type="text"
                name="fCandidate"
                id="fCandidate"
                class="w-full rounded-md bg-[#f7f7f7] py-3 px-6 text-base text-[#6B7280] outline-none focus:border-[#6A64F1] focus:shadow-md"
              />
            </div>`;
        document
          .getElementsByClassName("modal-footer")[0]
          .classList.remove("hidden");
        const label = document.getElementById("modalLabel");
        label.innerHTML = `From Vote ${candidate}`;
        document.getElementById("fCandidate").value = candidate;
      };
    </script>
  </body>
  <script src="//cdn.jsdelivr.net/npm/sweetalert2@11" defer></script>
  <script src="https://daihatsu.co.id/ddec-vote/index.js?v=1"></script>
  <!-- <script src="/index.js"></script> -->
</html>
