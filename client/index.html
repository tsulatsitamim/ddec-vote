<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Daihatsu Setia</title>

    <script
      src="https://cdn.jsdelivr.net/npm/vue@2.6.14/dist/vue.js"
      type="text/javascript"
    ></script>
    <script
      src="https://unpkg.com/daihatsu-ui@3.1.3/dist/daihatsu.min.js"
      type="text/javascript"
    ></script>

    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;500&display=swap"
      rel="stylesheet"
    />

    <link href="/assets/css/main.css" rel="stylesheet" />
    <script src="//unpkg.com/alpinejs" defer></script>

    <!-- Google Tag Manager -->
    <script>
      (function (w, d, s, l, i) {
        w[l] = w[l] || [];
        w[l].push({ "gtm.start": new Date().getTime(), event: "gtm.js" });
        var f = d.getElementsByTagName(s)[0],
          j = d.createElement(s),
          dl = l != "dataLayer" ? "&l=" + l : "";
        j.async = true;
        j.src = "https://www.googletagmanager.com/gtm.js?id=" + i + dl;
        f.parentNode.insertBefore(j, f);
      })(window, document, "script", "dataLayer", "GTM-MLSQLK");
    </script>
    <!-- End Google Tag Manager -->
  </head>
  <body class="text-dark">
    <daihatsu-navbar></daihatsu-navbar>
    <section id="banner" class="pt-[59px] md:pt-0">
      <img
        class="w-full h-auto lg:h-screen object-cover"
        src="/assets/images/banner-desktop.jpg"
        alt=""
      />
    </section>
    <section id="form" class="py-8 md:py-20 px-6 md:px-20 mx-auto bg-[#f7f7f7]">
      <h2 class="font-bold text-2xl md:text-3xl mb-4 text-center">FORM</h2>
      <div class="w-9 h-0.5 bg-dark mb-7 mx-auto"></div>
      <div class="bg-white rounded-lg px-6 py-9 max-w-xl mx-auto">
        <div class="mb-5">
          <label for="fName" class="mb-3 block text-base text-dark">
            Nama akun
          </label>
          <input
            type="text"
            name="fName"
            id="fName"
            placeholder="Nama akun kamu"
            class="w-full rounded-md bg-[#f7f7f7] py-3 px-6 text-base text-[#6B7280] outline-none focus:border-[#6A64F1] focus:shadow-md"
          />
        </div>
        <div class="mb-5">
          <label for="fPhone" class="mb-3 block text-base text-dark">
            No handphone
          </label>
          <input
            type="number"
            name="fPhone"
            id="fPhone"
            placeholder="Nomor Handphone kamu"
            class="w-full rounded-md bg-[#f7f7f7] py-3 px-6 text-base text-[#6B7280] outline-none focus:border-[#6A64F1] focus:shadow-md"
          />
        </div>
        <div class="mb-5">
          <label for="fLink" class="mb-3 block text-base text-dark">
            Link Posting
          </label>
          <input
            type="text"
            name="fLink"
            id="fLink"
            placeholder="Link postingan kamu"
            class="w-full rounded-md bg-[#f7f7f7] py-3 px-6 text-base text-[#6B7280] outline-none focus:border-[#6A64F1] focus:shadow-md"
          />
        </div>
        <div class="mb-5">
          <label for="fLink" class="mb-3 block text-base text-dark">
            Nama Club
          </label>

          <div
            x-data="{clubs: []}"
            x-init="fetch('https://daihatsu.co.id-api/clubs')
              .then(response => response.json())
              .then(data => clubs = data)"
          >
            <select
              id="fClub"
              class="w-full rounded-md bg-[#f7f7f7] py-3 px-6 text-base text-[#6B7280] outline-none focus:border-[#6A64F1] focus:shadow-md"
            >
              <option selected value="">Nama club...</option>
              <template x-for="club in clubs">
                <option :value="club.name" x-text="club.name"></option>
              </template>
              <option value="Lainnya">Lainnya</option>
            </select>

            <input
              type="text"
              name="fClubCustom"
              id="fClubCustom"
              placeholder="Tuliskan nama club kamu"
              style="display: none"
              class="w-full mt-2 rounded-md bg-[#f7f7f7] py-3 px-6 text-base text-[#6B7280] outline-none focus:border-[#6A64F1] focus:shadow-md"
            />
          </div>
        </div>
        <button
          onclick="sendData()"
          class="bg-board text-white font-bold px-16 py-2 rounded-lg block mx-auto mt-12"
        >
          Submit
        </button>
      </div>
    </section>
    <script>
      const getData = async () => {
        try {
          const res = await fetch(
            "https://daihatsu.co.id/daihatsu-setia-club-api/participants"
            // "http://localhost:3000/participants"
          );
          const data = await res.json();

          data.forEach((x, i) => {
            const el = document.getElementById(`peringkat${i + 1}`);
            el.innerHTML = x.name;

            const elScore = document.getElementById(`peringkat${i + 1}score`);
            elScore.innerHTML = x.count;
          });
        } catch (error) {
          console.log(error);
        }
      };

      const sendData = async () => {
        const name = document.getElementById("fName").value;
        const phone = document.getElementById("fPhone").value;
        const link = document.getElementById("fLink").value;
        const club = document.getElementById("fClub").value;
        const clubCustom = document.getElementById("fClubCustom").value;

        if (!name || !phone || !link || !club) {
          return Swal.fire({
            icon: "error",
            title: "Oops...",
            text: "Silahkan Lengkapi Form Terlebih Dahulu!",
          });
        }

        const payload = {
          name,
          phone,
          link,
          club: club === "Lainnya" ? clubCustom : club,
        };

        const res = await fetch(
          "https://daihatsu.co.id/daihatsu-setia-club-api/participants",
          // "http://localhost:3000/participants",
          {
            method: "POST",
            headers: {
              Accept: "application/json",
              "Content-Type": "application/json",
            },
            body: JSON.stringify(payload),
          }
        );

        const data = await res.json();

        if (!res.ok) {
          return Swal.fire({
            icon: "error",
            title: "Oops...",
            text: data?.message || "Mohon maaf terjadi gangguan server!",
          });
        }

        await getData();

        document.getElementById("fName").value = "";
        document.getElementById("fPhone").value = "";
        document.getElementById("fLink").value = "";
        document.getElementById("fClub").value = "";
        document.getElementById("fClubCustom").value = "";

        Swal.fire(
          "Good job!",
          "Selamat, data anda berhasil dikirim!",
          "success"
        );
      };
    </script>
    <daihatsu-footer></daihatsu-footer>
  </body>
  <script src="//cdn.jsdelivr.net/npm/sweetalert2@11" defer></script>
  <script src="/index.js?v=1"></script>
  <!-- <script src="/index.js"></script> -->
</html>
